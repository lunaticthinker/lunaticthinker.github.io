{{- $pages := .Site.RegularPages }}

{{- /* Merge missing translations from other languages */ -}}
{{- if .Site.Params.enableTranslationMerge -}}
{{- range .Site.Home.Translations -}}
{{- $pages = $pages | lang.Merge .Site.RegularPages -}}
{{- end -}}
{{- end -}}

{{- /* Set pages of main sections */ -}}
{{- $pages = where $pages "Section" "in" .Site.MainSections -}}
{{- $pages = $pages | union (where .Site.RegularPages "Type" "in" .Site.MainSections) -}}
{{- /* Filter to only show posts with "Home Page" category */ -}}
{{- $pages = where $pages "Params.categories" "intersect" (slice "Home Page") -}}
{{- /* Sort by date descending to ensure proper order */ -}}
{{- $pages = sort $pages "Date" "desc" -}}
{{- .Site.Store.Set "mainSectionPages" $pages -}}

{{- /* Select the scope named `public_repo` to generate personal access token */ -}}
{{- $header := dict "Authorization" "" -}}
{{- with (getenv "HUGO_PARAMS_GHTOKEN") -}}
{{- $header = dict "Authorization" (printf "token %v" .) -}}
{{- end -}}
{{- hugo.Store.Set "githubTokenHeader" $header -}}
